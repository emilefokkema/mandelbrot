!function(){var n={};!function(){var t,e,r,o,i,a,u,c,s,f;t=function(n,t){if(n&&1==arguments.length)throw"when making a sender with a reducer, please supply an initial value";var e=[],r=function(){var r=arguments,o=e.map(function(n){return n.apply(null,r)});if(n)return o.reduce(n,t)};return r.add=function(n){return e.push(n),r},r.remove=function(n){var t;-1!=(t=e.indexOf(n))&&e.splice(t,1)},r},e=function(n){var e=null,r=t(),o=t(),i=t(function(n,t){return n&&t},!0),a=t(),u=!1,c=n.getBoundingClientRect(),s=c.width,f=c.height;n.setAttribute("width",s),n.setAttribute("height",f),n.setAttribute("style","width:"+s+"px;height:"+f+"px;");var d=n.getContext("2d"),l=function(t,e){var r=n.getBoundingClientRect();return{x:t-r.left,y:e-r.top}},v=function(){var t=function(t,e){var r=new CustomEvent("positiondragstart",{detail:{x:t,y:e}});n.dispatchEvent(r)},e=function(t,e){var r=new CustomEvent("positiondragmove",{detail:{toX:t,toY:e}});n.dispatchEvent(r)},r=function(){var t=new CustomEvent("positiondragend");n.dispatchEvent(t)},o=function(t){var e=new CustomEvent("startzoom",{detail:{r:t}});n.dispatchEvent(e)},i=function(){var t=new CustomEvent("endzoom");n.dispatchEvent(t)},a=function(t){var e=new CustomEvent("changezoom",{detail:{r:t}});n.dispatchEvent(e)};return{make:function(n,u,c){t(n,u);var s,f={x:n,y:u,id:c},d=function(){return Math.sqrt(Math.pow(f.x-s.x,2)+Math.pow(f.y-s.y,2))};return{moveTo:function(n,t,r){void 0==r||r==f.id?(e(n,t),void 0!=r&&r==f.id&&(f.x=n,f.y=t)):s&&r==s.id&&(s.x=n,s.y=t,a(d()))},end:function(n){void 0==n||n==f.id?r():s&&n==s.id&&(i(),s=null)},add:function(n,t,e){e==f.id||s||(s={x:n,y:t,id:e},o(d()))}}}}}(),h=function(n,t){for(var e=0;e<n.length;e++)t(n.item(e))},m=function(){n.width=s,r()};return n.addEventListener("click",function(n){if(u)return u=!1,n.stopPropagation(),!1;var t=l(n.clientX,n.clientY);o(t.x,t.y,n.shiftKey)}),n.addEventListener("touchstart",function(n){h(n.changedTouches,function(n){var t=l(n.clientX,n.clientY);e?e.add(t.x,t.y,n.identifier):e=v.make(t.x,t.y,n.identifier)})}),n.addEventListener("touchend",function(n){e&&(h(n.changedTouches,function(n){e.end(n.identifier)}),0==n.touches.length&&(e=null))}),n.addEventListener("touchmove",function(n){return h(n.changedTouches,function(n){var t=l(n.clientX,n.clientY);e.moveTo(t.x,t.y,n.identifier)}),u=!0,n.preventDefault(),!1}),n.addEventListener("mousedown",function(n){n.preventDefault();var t=l(n.clientX,n.clientY);e=v.make(t.x,t.y)}),n.addEventListener("mousemove",function(t){if(0!=t.movementX||0!=t.movementY){var r=l(t.clientX,t.clientY);if(e)e.moveTo(r.x,r.y),u=!0;else{var o=new CustomEvent("custommousemove",{detail:{x:r.x,y:r.y}});n.dispatchEvent(o)}}return!0}),n.addEventListener("mouseup",function(){e&&(e.end(),e=null)}),n.addEventListener("contextmenu",function(n){e&&(e.end(),e=null);var t=l(n.clientX,n.clientY);return i(t.x,t.y,function(){n.preventDefault()})}),n.addEventListener("wheel",function(n){var t=l(n.clientX,n.clientY);return a(t.x,t.y,n.deltaY),n.preventDefault(),!1}),{w:s,h:f,context:d,onDraw:function(n){r.add(n)},clear:function(){n.width=s},drawAll:m,onClick:function(n){o.add(n)},onContextMenu:function(n){i.add(n)},onWheel:function(n){a.add(n)},addEventListener:function(t,e){"click"==t?o=e:n.addEventListener(t,e)},toDataURL:function(){return n.toDataURL.apply(n,arguments)}}},r=function(){var n,t,e,r=function(n,t,e,r,o,i){this.a=n,this.b=t,this.c=e,this.d=r,this.e=o,this.f=i};return Object.defineProperty(r.prototype,"size",{get:function(){return Math.sqrt(Math.abs(this.a*this.d-this.b*this.c))}}),r.prototype.before=function(n){var t=this.a*n.a+this.b*n.c,e=this.a*n.b+this.b*n.d,o=this.c*n.a+this.d*n.c,i=this.c*n.b+this.d*n.d,a=this.e*n.a+this.f*n.c+n.e,u=this.e*n.b+this.f*n.d+n.f;return new r(t,e,o,i,a,u)},r.prototype.apply=function(n,t){return{x:this.a*n+this.c*t+this.e,y:this.b*n+this.d*t+this.f}},r.prototype.translate=function(n,e){return t(n,e).before(this)},r.prototype.scale=function(n,t){return e(n,t).before(this)},r.prototype.add=function(n){return n.before(this)},r.prototype.inverse=function(){var n=this.a*this.d-this.b*this.c;if(0==n)throw"error calculating inverse: zero determinant";var t=this.d/n,e=-this.b/n,o=-this.c/n,i=this.a/n,a=(this.c*this.f-this.d*this.e)/n,u=(this.b*this.e-this.a*this.f)/n;return new r(t,e,o,i,a,u)},n=function(n){var t=Math.sin(n),e=Math.cos(n);return new r(e,t,-t,e,0,0)},e=function(n,t){return new r(n,0,0,t,0,0)},t=function(n,t){return new r(1,0,0,1,n,t)},r.rotation=n,r.translation=t,r.scale=e,r}(),o=function(n){var t=function(n,t){this.specs=n,this.currentContextTransform=t};return t.prototype.getTransformableContext=function(){var t=this.currentContextTransform;return{transform:function(e,r,o,i,a,u){t.addToCurrentTransform(new n(e,r,o,i,a,u))},rotate:function(e){t.addToCurrentTransform(n.rotation(e))},scale:function(e,r){t.addToCurrentTransform(n.scale(e,r))},translate:function(e,r){t.addToCurrentTransform(n.translation(e,r))}}},t.prototype.makeIterable=function(){if("function"==typeof Symbol){var n=Symbol.iterator,t={},e=this.makeIterator();return t[n]=function(){return e},t}},t.prototype.makeIterator=function(){var n=this.currentContextTransform.getTransformedViewBox(),t=this.specs.initialIndex||0;"function"==typeof t&&(t=t(n));var e=t,r=this.specs.includeIndex||function(){return!1},o=this.specs.transform||function(){},i=!0,a=0,u=!1,c=(this.specs.plusLimitPoint,this.specs.minLimitPoint,!r(1/0,n)),s=!r(-1/0,n),f=this.getTransformableContext(),d=this.currentContextTransform,l=function(){if(a++,r(e,n)&&(a<100||i&&c||!i&&s)){var v={value:e,done:!1};return u&&d.restoreTransform(),d.saveTransform(),o(e,f),u=!0,i?e++:e--,v}return i?(i=!1,e=t-1,a=0,l()):(d.restoreTransform(),{done:!0})};return{next:l}},t.prototype.each=function(n){for(var t=this.currentContextTransform.getTransformedViewBox(),e=this.specs.minIndex(t),r=this.specs.maxIndex(t),o=e;o<=r;o++)this.currentContextTransform.saveTransform(),this.specs.transform(o,this.transformableContext),n(),this.currentContextTransform.restoreTransform()},t}(r),i=function(n,t){return function(e,r){var o=function(n,t,e,o){var i=r.getTransformedViewBox(),a=i.x-i.width,u=i.x+2*i.width,c=i.y-i.height,s=i.y+2*i.height;return n==1/0&&(n=u),n==-1/0&&(n=a),t==1/0&&(n=s),t==-1/0&&(t=c),e===1/0&&(e=u-n),e==-1/0&&(e=a-n),o===1/0&&(o=s-t),o==-1/0&&(o=c-t),{x:n,y:t,width:e,height:o}},i=function(){},a={};for(var u in e)!function(n){"function"!=typeof e[n]?a[n]={get:function(){return e[n]},set:function(t){e[n]=t}}:a[n]={value:function(){return e[n].apply(e,arguments)}}}(u);return a.getRelativeSize={value:function(n){return n/r.getCurrentScale()}},a.save={value:function(){e.save(),r.saveTransform()}},a.restore={value:function(){e.restore(),r.restoreTransform()}},a.setTransform={value:function(t,e,o,i,a,u){r.setCurrentTransform(new n(t,e,o,i,a,u))}},a.rotate={value:function(t){r.addToCurrentTransform(n.rotation(t))}},a.transform={value:function(t,e,o,i,a,u){r.addToCurrentTransform(new n(t,e,o,i,a,u))}},a.transformMultiple={value:function(n){return new t(n,r).makeIterable()}},a.scale={value:function(t,e){r.addToCurrentTransform(n.scale(t,e))}},a.translate={value:function(t,e){r.addToCurrentTransform(n.translation(t,e))}},a.rect={value:function(n,t,r,i){var a=o(n,t,r,i);e.rect(a.x,a.y,a.width,a.height)}},a.fillRect={value:function(n,t,r,i){var a=o(n,t,r,i);e.fillRect(a.x,a.y,a.width,a.height)}},a.strokeRect={value:function(n,t,r,i){var a=o(n,t,r,i);e.strokeRect(a.x,a.y,a.width,a.height)}},i.prototype=Object.create({},a),new i}}(r,o),a=function(){var n=function(n,t,e,r){this.x=n,this.y=t,this.width=e,this.height=r};return n.prototype.expand=function(t){return new n(this.x-t,this.y-t,this.width+2*t,this.height+2*t)},n}(),u=function(n,t){return function(e,r,o){var i,a,u,c,s=new n(1,0,0,1,0,0),f=new n(1,0,0,1,0,0),d=[],l=function(){u=s.inverse(),i=s.add(f),a=i.inverse(),c=E()},v=function(n,t,e){var r=u.apply(t,e);s=s.translate(r.x,r.y).scale(n,n).translate(-r.x,-r.y),l()},h=function(t,e){var r,o,i,a=function(n,a){i=s,r=n,o=a,t=n,e=a};a(t,e);var u,c,f=function(){s=n.translation(r-t,o-e).add(i),l()},d=function(){s=n.translation(r-t,o-e).add(i),l(),v(c/u,r,o)};return{drag:function(n,t){r=n,o=t,void 0==c?f():d()},startZoom:function(n){u=n,c=n},changeZoom:function(n){c=n,d()},endZoom:function(){u=void 0,c=void 0,a(r,o)}}},m=function(n,t){return u.apply(n,t)},p=function(n){return s.apply(n.x,n.y)},y=function(){f=new n(1,0,0,1,0,0),l(),d=[]},x=function(){d.push(f)},T=function(){d.length&&(f=d.pop(),l(),w())},w=function(){var n=i;e.setTransform(n.a,n.b,n.c,n.d,n.e,n.f)},g=function(){var n=f;e.setTransform(n.a,n.b,n.c,n.d,n.e,n.f)},C=function(n){f=n,l(),w()},b=function(n){f=f.add(n),l(),w()},E=function(){var n=a,e=n.apply(0,0),i=n.apply(0,o),u=n.apply(r,o),c=n.apply(r,0),s=Math.min(e.x,i.x,u.x,c.x),f=Math.max(e.x,i.x,u.x,c.x),d=Math.min(e.y,i.y,u.y,c.y),l=Math.max(e.y,i.y,u.y,c.y);return new t(s,d,f-s,l-d)},L=function(){return s.size},M=function(){return{a:s.a,b:s.b,c:s.c,d:s.d,e:s.e,f:s.f}},z=function(){return{a:u.a,b:u.b,c:u.c,d:u.d,e:u.e,f:u.f}};return l(),{zoom:v,getCurrentScale:L,getCurrentTransform:M,getCurrentInverseTransform:z,makeDrag:h,screenPositionToPoint:m,positionToMousePosition:p,removeTransform:y,saveTransform:x,restoreTransform:T,setTransform:w,resetTransform:g,setCurrentTransform:C,addToCurrentTransform:b,getTransformedViewBox:function(){return c}}}}(r,a),c=function(){return function(n,t,e,r){var o,i,a,u=!1,c=function(){i=e.apply(null,a),t(i,o)?setTimeout(c,10):(u=!1,r&&r())};return function(){a=Array.prototype.slice.apply(arguments),o=n.apply(null,a),u||(u=!0,c())}}}(),s=function(n){var t=function(t,e){var r=0,o=0,i=Math.floor(t.width/e)+1,a=Math.floor(t.height/e)+1,u={done:!0},c=function(){return{value:new n(t.x+o*e,t.y+r*e,e,e)}};return{next:function(){if(o<=i&&r<=a){var n=c();return o++,o>i&&(o=0,r++),n}return u}}},e=function(){var n=[],t=function(t){var e=!1,r=function(){if(!e)return t.apply(null,arguments)};return r.cancel=function(){e=!0;var t=n.indexOf(r);t>-1&&n.splice(t,1)},n.push(r),r};return{cancelOpen:function(){n.slice().map(function(n){n.cancel()})},make:function(n){return t(n)}}};return function(n,r,o,i,a,u,c){var s,f,d,l,v,h,m,p=!1,y=e(),x=0;return f=function(){if(!s){var e=o.getTransformedViewBox();l=t(e,u/o.getCurrentScale()),s=!0,v=function(){s&&(h=l.next(),h.done?(s=!1,p=!0):(o.removeTransform(),o.setTransform(),n(a,h.value,y.make(function(){x++,x<c?v():(x=0,setTimeout(v,1))})),o.resetTransform()))},v()}},d=function(){s=!1,p=!1,y.cancelOpen();var n=o.getCurrentInverseTransform(),t=i.toDataURL(),e=new Image;e.src=t,r(),r(function(t){t.save(),t.transform(n.a,n.b,n.c,n.d,n.e,n.f),t.drawImage(e,0,0),t.restore()})},{start:f,pauze:function(){(s||p)&&d(),m&&clearTimeout(m),m=setTimeout(f,1e3)}}}}(a),f=function(n,t,e,r,o,i){var a={SYNC:1,ASYNC:2},u=function(n){var u,c,s=n.w,f=n.h,d=n.context,l=r(d,s,f),v=t(),h=t(),m=t(),p=t(function(n,t){return n&&t},!0),y=t(function(n,t){return n&&t},!0),x=null,T=function(n,t){x=l.makeDrag(n,t)},w=function(n,t){x&&x.drag(n,t)},g=function(){x=null},C=function(n){x&&x.startZoom(n)},b=function(n){x&&x.changeZoom(n)},E=function(){x&&x.endZoom()},L=e(d,l),M=function(e,r,o){var a=function(e){e?v.add(e):v=t(),n.drawAll()},u=i(e,a,l,n,L,r,o);return u.start(),u};n.onClick(function(n,t,e){var r=l.screenPositionToPoint(n,t);r.shiftKey=e,h(r)}),n.addEventListener("positiondragmove",function(t){c&&c.pauze(),w(t.detail.toX,t.detail.toY),n.drawAll()}),n.addEventListener("positiondragend",function(){g(),m(),c?c.start():n.drawAll()}),n.addEventListener("positiondragstart",function(n){var t=l.screenPositionToPoint(n.detail.x,n.detail.y);y(t.x,t.y)&&T(n.detail.x,n.detail.y)}),n.addEventListener("startzoom",function(n){C(n.detail.r)}),n.addEventListener("changezoom",function(t){c&&c.pauze(),b(t.detail.r),n.drawAll()}),n.addEventListener("endzoom",function(n){E(),c&&c.start()}),n.onDraw(function(){l.removeTransform(),l.setTransform(),v(L),l.resetTransform()}),n.onContextMenu(function(n,t,e){var r=l.screenPositionToPoint(n,t);return p(n,t,r.x,r.y,e)}),n.onWheel(o(function(n,t,e){var r=Math.pow(2,-e/100);return l.getCurrentScale()*r},function(n,t){return n<.9*t||n>1.1*t},function(t,e,r){return c&&c.pauze(),r>0&&(l.zoom(.9,t,e),n.drawAll()),r<0&&(l.zoom(1.1,t,e),n.drawAll()),l.getCurrentScale()},function(){c&&c.start()}));var z={onDragMove:function(t){n.addEventListener("positiondragmove",function(n){var e=l.screenPositionToPoint(n.detail.toX,n.detail.toY);t(e.x,e.y)})},onMouseMove:function(t){n.addEventListener("custommousemove",function(n){var e=l.screenPositionToPoint(n.detail.x,n.detail.y);t(e.x,e.y)})},zoom:l.zoom,drawAll:function(){n.drawAll()},onDraw:function(e){if(u===a.ASYNC)throw"onDraw not available in async mode";u=a.SYNC,e?v.add(e):v=t(),n.drawAll()},drawAsync:function(n){var t=n.f,e=n.boxSize||5,r=n.chunkSize||1;if(u===a.SYNC)throw"onDrawAsync not available in sync mode";u=a.ASYNC,c||(c=M(t,e,r))},onClick:function(n){h.add(n)},onContextMenu:function(n){p.add(n)},onDragStart:function(n){y.add(n)},onDragEnd:function(n){m.add(n)},toDataURL:function(){return n.toDataURL.apply(null,arguments)}};return Object.defineProperty(z,"scale",{get:function(){return l.getCurrentScale()}}),Object.defineProperty(z,"transform",{get:function(){return l.getCurrentTransform()}}),z};return function(t){return u(n(t))}}(e,t,i,u,c,s),function(t){n.infiniteCanvas=t}(f)}(),"function"==typeof define?define("infiniteCanvas",[],function(){return n.infiniteCanvas}):window.infiniteCanvas=n.infiniteCanvas}();